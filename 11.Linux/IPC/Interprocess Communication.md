
每个进程各⾃有不同的⽤户地址空间,任何⼀个进程的全局变量在另⼀个进程中都看不到，所以进程之间要交换数据必须通过内核,在内核中开辟⼀块缓冲区,进程1把数据从⽤户空间拷到内核缓冲区,进程2再从内核缓冲区把数据读⾛,内核提供的这种机制称为**进程间通信**(IPC,InterProcess Communication) 

常用的进程间通信方式：

- 传统的进程间通信方式:无名管道(pipe)、有名管道(fifo)和信号(signal)
- System v IPC对象:共享内存(share memory)、消息队列(message queue)和信号量
- C.BSD:套接字(socket) 

## 1. pipe
### 1.1. 管道特点

- 1.管道只允许具有血缘关系的进程间通信，如父子进程间的通信。
- 2.管道只允许**单向通信**。
- 3.管道内部保证同步机制，从而保证访问数据的一致性。
- 4.面向字节流
- 5.管道随进程，进程在管道在，进程消失管道对应的端口也关闭，两个进程都消失管道也消失。

### 1.2. pipe
* 原理：管道实为内核使用**环形队列机制**（以便管道可以重复利用），借助内核缓冲区（4k）实现
* 本质：是一个伪文件（实为内核缓冲区），由两个文件描述符引用，一个表示读端，一个表示写端。数据从管道的写端流入，从读端流出。

* 管道缓冲区大小
```
//命令查看当前系统中创建管道文件所对应的内核缓冲区的大小
ulimit -a
```

### 1.3. 管道的读写行为

#### 1).读管道
1.管道中有数据，read返回实际读到的字节数。  
2.管道中无数据：  
（1）管道写端被全部关闭，read返回0  
（2）管道写端没有全部被关闭，read阻塞等待（等待管道中有数据可读）  
#### 2).写管道
1.管道读端全部被关闭，进程异常终止。  
2.管道读端没有全部关闭：  
（1）管道已满，write阻塞。  
（2）管道未满，write将数据写入，并返回实际写入的字节数。  
## 2. FIFO
有名管道也叫命名管道，在文件系统目录中存在一个管道文件。管道文件仅仅是文件系统中的标示，**并不在磁盘上占据空间**。在使用时，**在内存上开辟空间**，作为两个进程数据交互的通道。
### 2.1. 管道文件的创建：
1) 在shell中使用mkfifo 命令 
```
mkfifo filename
```
2) mkfifo 函数 (在代码中使用其创建管道文件) 
```
#include <sys/types.h>
#include <sys/stat.h>

int mkfifo(const char *filename,mode_t mode);
```
### 2.2. 使用方式：
1）使用open函数打开管道文件  
如果一个进程以只读(只写)打开，那么这个进程会被阻塞到open，直到另一个进程以只写(只读)或者读写。  
2）使用read函数读取内容  
read读取普通文件，read不会阻塞。而read读取管道文件，read会阻塞运行，直到管道中有数据或者所有的写端关闭。  
3）使用write函数发送内容，使用close函数关闭打开的文件。